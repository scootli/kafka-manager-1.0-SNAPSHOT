package baidu.scloud.data.aggregate.visitorpage;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import net.sf.json.JSONArray;
import baidu.scloud.data.aggregate.base64.Base64;
import baidu.scloud.data.aggregate.heap.VisitorPage;

public class VisitorPageUtils {
	/**
	 * Get visitor page json and base64 result from topk minHeap
	 * @param data
	 * @param topk
	 * @param dataLen: data actual size
	 * @return: topk visitor uri json and base64 result
	 */
	public static String getVistorPageJsonContent(VisitorPage[] data,int topk,int dataLen){
		int size = (dataLen > topk)? topk : dataLen;
		List<Map> list = new ArrayList<Map>();
		for(int index = 0;index < size;index++){
			Map<String,String> topUri2Count = new HashMap<String,String>();
			topUri2Count.put("url","http://" + data[index].get_uri());
			topUri2Count.put("sum",data[index].get_req_pv_count() + "");
			list.add(topUri2Count);
		}
		
		//JSONArray jsonArray = JSONArray.fromObject(list);
		String content = JSONArray.fromObject(list).toString();
		return Base64.getBase64(content);
	}
}
